<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>TODO supply a title</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=0.0">

    </head>
    <body>
        <div id="pacman" style="font-family: Courier New; font-size: 25px; font-weight: bold; line-height: 17px;"></div>
    </body>
    <script>

        var tablero = new Array(30);

        tablero[00] = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
        tablero[01] = [0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0];
        tablero[02] = [0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0];
        tablero[03] = [0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0];
        tablero[04] = [0, 1, 0, 0, 1, 0, 0, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0];
        tablero[05] = [0, 1, 0, 0, 1, 0, 1, 1, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0];
        tablero[06] = [0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0];
        tablero[07] = [0, 1, 0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 1, 0, 1, 1, 1, 1, 0, 1, 0];
        tablero[08] = [0, 1, 1, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 1, 1, 1, 1, 0, 0, 1, 0, 0, 0, 1, 0];
        tablero[09] = [0, 1, 0, 1, 0, 0, 1, 0, 0, 1, 1, 1, 1, 1, 0, 0, 1, 1, 1, 0, 0, 1, 0, 0, 1, 1, 1, 0, 1, 0];
        tablero[10] = [0, 1, 0, 1, 0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 1, 1, 0];
        tablero[11] = [0, 1, 0, 1, 1, 1, 1, 0, 0, 1, 0, 1, 1, 1, 1, 0, 0, 0, 1, 0, 0, 1, 1, 0, 0, 0, 1, 0, 0, 0];
        tablero[12] = [0, 1, 1, 1, 0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 0, 0, 1, 0, 0, 0];
        tablero[13] = [0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 0];
        tablero[14] = [0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 1, 1, 1, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 0];
        tablero[15] = [0, 0, 0, 0, 1, 1, 1, 1, 0, 1, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 0, 0, 0];
        tablero[16] = [0, 1, 1, 1, 1, 0, 0, 1, 0, 1, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 1, 0];
        tablero[17] = [0, 1, 0, 0, 1, 0, 0, 1, 0, 1, 1, 1, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 1, 1, 1, 0, 1, 0];
        tablero[18] = [0, 1, 0, 0, 1, 1, 1, 1, 0, 1, 0, 1, 0, 1, 0, 1, 1, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 1, 0];
        tablero[19] = [0, 1, 0, 0, 1, 0, 0, 1, 1, 1, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 1, 0];
        tablero[20] = [0, 1, 1, 1, 1, 0, 0, 1, 0, 1, 0, 1, 1, 1, 1, 1, 0, 1, 0, 1, 0, 1, 1, 1, 1, 0, 0, 1, 1, 0];
        tablero[21] = [0, 1, 0, 0, 1, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 1, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 0, 0];
        tablero[22] = [0, 1, 0, 0, 1, 1, 1, 1, 0, 1, 0, 1, 0, 1, 1, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0];
        tablero[23] = [0, 1, 0, 0, 1, 0, 0, 1, 0, 1, 1, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0];
        tablero[24] = [0, 1, 0, 0, 1, 0, 0, 1, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 0, 0, 0, 0, 0];
        tablero[25] = [0, 1, 0, 0, 1, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0];
        tablero[26] = [0, 1, 1, 1, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 1, 0, 1, 0, 0, 1, 1, 1, 1, 0, 0];
        tablero[27] = [0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 1, 0];
        tablero[28] = [0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 0];
        tablero[29] = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];

        function consola() {
            var fila = "";

            for (var x = 0; x < tablero.length; x++) {
                fila += "\n";
                for (var y = 0; y < tablero[x].length; y++) {
                    if (tablero[x][y] === 0) {
                        fila += "X";
                    } else if (tablero[x][y] === 1) {
                        fila += " ";
                    } else if (tablero[x][y] === "F") {
                        fila += "F";
                    } else {
                        fila += "@";
                    }
                }
            }
            console.log(fila);
        }

        function imprimir() {
            var fila = "";

            for (var x = 0; x < tablero.length; x++) {
                fila += "<br>";
                for (var y = 0; y < tablero[x].length; y++) {
                    if (tablero[x][y] === 0) {
                        fila += "X";
                    } else if (tablero[x][y] === 1) {
                        fila += "&nbsp;";
                    } else if (tablero[x][y] === "F") {
                        fila += "<span style='color:red;'>F</span>";
                    } else {
                        fila += "<span style='color:darkblue;'>@</span>";
                    }
                }
            }
            document.getElementById("pacman").innerHTML = fila;
        }
        function aleatorio(min, max) {
            return Math.floor(Math.random() * ((max + 1) - min) + min);
        }

        //variables para el jugador
        /*var datosJug = ["X", "Y", "Direc", "anarDirec"];
         var jug = [datosJug];*/

        var jugador = new Array(4);

        var fantasmas = new Array(3);
        for (var i = 0; i < fantasmas.length; i++) {
            fantasmas[i] = new Array(3);
        }

        //ubicacion random fantasmas y jugador

        function fAleatori() {

            for (var i = 0; i < fantasmas.length; i++) {

                do {
                    var num = aleatorio(0, 29);
                    var num2 = aleatorio(0, 29);
                } while (tablero[num][num2] != 1);
                tablero[num][num2] = "F";
                fantasmas[i][0] = num;
                fantasmas[i][1] = num2;
            }
        }
        function jAleatori() {
            do {
                var num = aleatorio(0, 29);
                var num2 = aleatorio(0, 29);
            } while (tablero[num][num2] != 1);

            if (tablero[num + 1][num2] == "F" || tablero[num - 1][num2] == "F" || tablero[num][num2 + 1] == "F" || tablero[num][num2 - 1] == "F") {
                jAleatori();
            } else {
                tablero[num][num2] = "@";
                var num3 = aleatorio(1, 4);
                jugador[0] = num;
                jugador[1] = num2;
                jugador[2] = num3;
                //jugador[i][3] = num4;
            }
        }
        // busca una direccion posible a UN fantasma
        function fRedireccion(i) {
            do {
                var fora = 0;
                var direccio = aleatorio(1, 4);
                switch (direccio) {
                    case 1:
                        if (tablero[(fantasmas[i][0]) - 1][fantasmas[i][1]] === 0) {
                            fora = 0;
                        } else {
                            fantasmas[i][2] = direccio;
                            fora = 1;
                        }
                        break;
                    case 2:
                        if (tablero[(fantasmas[i][0]) + 1][fantasmas[i][1]] === 0) {
                            fora = 0;
                        } else {
                            fantasmas[i][2] = direccio;
                            fora = 1;
                        }
                        break;
                    case 3:
                        if (tablero[fantasmas[i][0]][(fantasmas[i][1]) - 1] === 0) {
                            fora = 0;
                        } else {
                            fantasmas[i][2] = direccio;
                            fora = 1;
                        }
                        break;
                    case 4:
                        if (tablero[fantasmas[i][0]][(fantasmas[i][1]) + 1] === 0) {
                            fora = 0;
                        } else {
                            fantasmas[i][2] = direccio;
                            fora = 1;
                        }
                        break;
                }
            } while (fora === 0);
        }

        // Hace que busque una direccion de UN fantasma para los 3 fantasmas
        function fDireccion() {
            for (var i = 0; i < fantasmas.length; i++) {
                fRedireccion(i);
            }
        }
        //Busca direccion valida para el jugador
        function jDireccion() {
            do {
                var fora = 0;
                var direccio = aleatorio(1, 4);
                switch (direccio) {
                    case 1:
                        if (tablero[(jugador[0]) - 1][jugador[1]] === 0) {
                            fora = 0;
                        } else {
                            jugador[2] = direccio;
                            fora = 1;
                        }
                        break;
                    case 2:
                        if (tablero[(jugador[0]) + 1][jugador[1]] === 0) {
                            fora = 0;
                        } else {
                            jugador[2] = direccio;
                            fora = 1;
                        }
                        break;
                    case 3:
                        if (tablero[jugador[0]][(jugador[1]) - 1] === 0) {
                            fora = 0;
                        } else {
                            jugador[2] = direccio;
                            fora = 1;
                        }
                        break;
                    case 4:
                        if (tablero[jugador[0]][(jugador[1]) + 1] === 0) {
                            fora = 0;
                        } else {
                            jugador[2] = direccio;
                            fora = 1;
                        }
                        break;

                }
            } while (fora === 0);
        }
        //comprueba el movimiento de los fantasmas, si tiene 3 o 4 posibles caminos, llama a la funcion
        // que busca un num aleatori.
        function fComprobarMov() {
            for (var i = 0; i < fantasmas.length; i++) {

                var camino = 0;

                if (tablero[(fantasmas[i][0]) - 1][fantasmas[i][1]] === 1) {
                    camino++;
                }
                if (tablero[(fantasmas[i][0]) + 1][fantasmas[i][1]] === 1) {
                    camino++;
                }
                if (tablero[fantasmas[i][0]][(fantasmas[i][1]) - 1] === 1) {
                    camino++;
                }
                if (tablero[fantasmas[i][0]][(fantasmas[i][1]) + 1] === 1) {
                    camino++;
                }
                if (camino >= 3) {
                    fRedireccion(i);
                }
                comprovar(i);
            }
        }

        function comprovar(i) {

            var direccio = fantasmas[i][2];
            switch (direccio) {
                case 1:
                    if (tablero[(fantasmas[i][0]) - 1][fantasmas[i][1]] === 0) {
                        fRedireccion(i);
                    }
                    break;
                case 2:
                    if (tablero[(fantasmas[i][0]) + 1][fantasmas[i][1]] === 0) {
                        fRedireccion(i);
                    }
                    break;
                case 3:
                    if (tablero[fantasmas[i][0]][(fantasmas[i][1]) - 1] === 0) {
                        fRedireccion(i);
                    }
                    break;
                case 4:
                    if (tablero[fantasmas[i][0]][(fantasmas[i][1]) + 1] === 0) {
                        fRedireccion(i);
                    }
                    break;
            }

        }

        /*function fMover() {
         
         for (var i = 0; i < fantasmas.length; i++) {
         if (fantasmas[i][2] === 1) {
         tablero[(fantasmas[i][0]) - 1][fantasmas[i][1]] = "F";
         tablero[(fantasmas[i][0])][fantasmas[i][1]] = 1;
         fantasmas[i][0] = (fantasmas[i][0]) - 1;
         }
         else if (fantasmas[i][2] === 2) {
         tablero[(fantasmas[i][0]) + 1][fantasmas[i][1]] = "F";
         tablero[fantasmas[i][0]][fantasmas[i][1]] = 1;
         fantasmas[i][0] = (fantasmas[i][0]) + 1;
         }
         else if (fantasmas[i][2] === 3) {
         tablero[fantasmas[i][0]][(fantasmas[i][1]) - 1] = "F";
         tablero[fantasmas[i][0]][fantasmas[i][1]] = 1;
         fantasmas[i][1] = (fantasmas[i][0]) - 1;
         }
         else if (fantasmas[i][2] === 4) {
         tablero[fantasmas[i][0]][(fantasmas[i][1]) + 1] = "F";
         tablero[fantasmas[i][0]][fantasmas[i][1]] = 1;
         fantasmas[i][1] = (fantasmas[i][0]) + 1;
         }
         
         }
         fComprobarMov();
         }*/

        function fMover() {
            for (var i = 0; i < fantasmas.length; i++) {

                var dir = fantasmas[i][2];
                switch (dir) {
                    case 1:
                        tablero[(fantasmas[i][0]) - 1][fantasmas[i][1]] = 'F';
                        tablero[(fantasmas[i][0])][fantasmas[i][1]] = 1;

                        fantasmas[i][0] = (fantasmas[i][0]) - 1;


                        break;
                    case 2:
                        tablero[(fantasmas[i][0]) + 1][fantasmas[i][1]] = 'F';
                        tablero[(fantasmas[i][0])][fantasmas[i][1]] = 1;

                        fantasmas[i][0] = (fantasmas[i][0]) + 1;

                        break;
                    case 3:
                        tablero[fantasmas[i][0]][(fantasmas[i][1]) - 1] = 'F';
                        tablero[(fantasmas[i][0])][fantasmas[i][1]] = 1;

                        fantasmas[i][1] = (fantasmas[i][1]) - 1;

                        break;
                    case 4:
                        tablero[fantasmas[i][0]][(fantasmas[i][1]) + 1] = 'F';
                        tablero[(fantasmas[i][0])][fantasmas[i][1]] = 1;

                        fantasmas[i][1] = (fantasmas[i][1]) + 1;

                        break;
                }

            }
            fComprobarMov();
        }

        // adalt = 1
        // abaix = 2
        // esquerra = 3
        // dreta = 4

        fAleatori();
        jAleatori();
        fDireccion();
        jDireccion();
        imprimir();
        consola();

        setInterval(function () {
            fMover();
            imprimir();
        }, 50);
        // clearInterval(a);
    </script>
</html>
