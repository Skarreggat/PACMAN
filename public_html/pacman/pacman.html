<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>TODO supply a title</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=0.0">

    </head>
    <body id="all">
        <br>
        <div id="puntuacio" style="border-style: double; border-color: red; padding: 0.5rem; border-width: 0.5rem;
             width: 100px; margin-left: 160px;">Puntuació: 0</div>
        <br>
        <div id="pacman" style="font-family: Courier New; font-size: 25px; font-weight: bold; line-height: 1px;"></div>
        <div id="pervic" style="margin-left: 50%; margin-top: -25%; font-size: 45px; color: blue; 
             "></div>
    </body>
    <script>
        // creacion del tablero
        var tablero = new Array(30);

        tablero[00] = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
        tablero[01] = [0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0];
        tablero[02] = [0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0];
        tablero[03] = [0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0];
        tablero[04] = [0, 1, 0, 0, 1, 0, 0, 1, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0];
        tablero[05] = [0, 1, 0, 0, 1, 0, 1, 1, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0];
        tablero[06] = [0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0];
        tablero[07] = [0, 1, 0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 1, 0, 1, 1, 1, 1, 0, 1, 0];
        tablero[08] = [0, 1, 1, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 1, 1, 1, 1, 0, 0, 1, 0, 0, 0, 1, 0];
        tablero[09] = [0, 1, 0, 1, 0, 0, 1, 0, 0, 1, 1, 1, 1, 1, 0, 0, 1, 1, 1, 0, 0, 1, 0, 0, 1, 1, 1, 0, 1, 0];
        tablero[10] = [0, 1, 0, 1, 0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 1, 1, 0];
        tablero[11] = [0, 1, 0, 1, 1, 1, 1, 0, 0, 1, 0, 1, 1, 1, 1, 0, 0, 0, 1, 0, 0, 1, 1, 0, 0, 0, 1, 0, 0, 0];
        tablero[12] = [0, 1, 1, 1, 0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 0, 0, 1, 0, 0, 0];
        tablero[13] = [0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 0];
        tablero[14] = [0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 1, 1, 1, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 0];
        tablero[15] = [0, 0, 0, 0, 1, 1, 1, 1, 0, 1, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 0, 0, 0];
        tablero[16] = [0, 1, 1, 1, 1, 0, 0, 1, 0, 1, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 1, 1, 0];
        tablero[17] = [0, 1, 0, 0, 1, 0, 0, 1, 0, 1, 1, 1, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 1, 1, 1, 0, 1, 0];
        tablero[18] = [0, 1, 0, 0, 1, 1, 1, 1, 0, 1, 0, 1, 0, 1, 0, 1, 1, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 1, 0];
        tablero[19] = [0, 1, 0, 0, 1, 0, 0, 1, 1, 1, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 1, 0];
        tablero[20] = [0, 1, 1, 1, 1, 0, 0, 1, 0, 1, 0, 1, 1, 1, 1, 1, 0, 1, 0, 1, 0, 1, 1, 1, 1, 0, 0, 1, 1, 0];
        tablero[21] = [0, 1, 0, 0, 1, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0, 1, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 0, 0];
        tablero[22] = [0, 1, 0, 0, 1, 1, 1, 1, 0, 1, 0, 1, 0, 1, 1, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0];
        tablero[23] = [0, 1, 0, 0, 1, 0, 0, 1, 0, 1, 1, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0];
        tablero[24] = [0, 1, 0, 0, 1, 0, 0, 1, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 0, 0, 0, 0, 0];
        tablero[25] = [0, 1, 0, 0, 1, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0];
        tablero[26] = [0, 1, 1, 1, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 1, 0, 1, 0, 0, 1, 1, 1, 1, 0, 0];
        tablero[27] = [0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 1, 0];
        tablero[28] = [0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 0];
        tablero[29] = [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0];
        // la funcion consola mostraria el tablero en el console.log
        function consola() {
            var fila = "";

            for (var x = 0; x < tablero.length; x++) {
                fila += "\n";
                for (var y = 0; y < tablero[x].length; y++) {
                    if (tablero[x][y] === 0) {
                        fila += "X";
                    } else if (tablero[x][y] === 1) {
                        fila += " ";
                    } else if (tablero[x][y] === "F") {
                        fila += "F";
                    } else {
                        fila += "@";
                    }
                }
            }
            console.log(fila);
        }
        //la funcion imprimir muestra el tablero en la propia "web", añadiendo imagenes a las paredes,
        //fantasmas y jugador.
        function imprimir() {
            var fila = "";
            for (var x = 0; x < tablero.length; x++) {
                fila += "<br>";
                for (var y = 0; y < tablero[x].length; y++) {
                    if (tablero[x][y] === 0) {
                        fila += "<img src='cuadrado-azul.png' height='15px' width='15px'>";
                    } else if (tablero[x][y] === 1) {
                        fila += "&nbsp";
                    } else if (tablero[x][y] === "F") {
                        fila += "<img src='fantasma.jpg' height='15px' width='15px'>";
                    } else {
                        fila += "<img src='pacman.png' height='15px' width='15px'>";
                    }
                }
            }
            document.getElementById("pacman").innerHTML = fila;
        }
        
        //funcion que usaremos siempre que queramos sacar un número aleatorio.
        function aleatorio(min, max) {
            return Math.floor(Math.random() * ((max + 1) - min) + min);
        }
        
        //creacion de arrays de fantasmas y jugador
        var jugador = new Array(4);

        var fantasmas = new Array(3);
        for (var i = 0; i < fantasmas.length; i++) {
            fantasmas[i] = new Array(3);
        }

        //ubicacion aleatorio fantasmas y jugador

        function fAleatori() {

            for (var i = 0; i < fantasmas.length; i++) {

                do {
                    var num = aleatorio(0, 29);
                    var num2 = aleatorio(0, 29);
                } while (tablero[num][num2] != 1);
                tablero[num][num2] = "F";
                fantasmas[i][0] = num;
                fantasmas[i][1] = num2;
            }
        }
        function jAleatori() {
            do {
                var num = aleatorio(0, 29);
                var num2 = aleatorio(0, 29);
            } while (tablero[num][num2] != 1);

            if (tablero[num + 1][num2] == "F" || tablero[num - 1][num2] == "F" || tablero[num][num2 + 1] == "F" || tablero[num][num2 - 1] == "F") {
                jAleatori();
            } else {
                tablero[num][num2] = "@";
                var num3 = aleatorio(1, 4);
                jugador[0] = num;
                jugador[1] = num2;
                jugador[2] = num3;
                //jugador[i][3] = num4;
            }
        }
        // busca una direccion posible a UN fantasma
        function fRedireccion(i) {
            do {
                var fora = 0;
                var direccio = aleatorio(1, 4);
                switch (direccio) {
                    case 1:
                        if (tablero[(fantasmas[i][0]) - 1][fantasmas[i][1]] === 0) {
                            fora = 0;
                        } else {
                            fantasmas[i][2] = direccio;
                            fora = 1;
                        }
                        break;
                    case 2:
                        if (tablero[(fantasmas[i][0]) + 1][fantasmas[i][1]] === 0) {
                            fora = 0;
                        } else {
                            fantasmas[i][2] = direccio;
                            fora = 1;
                        }
                        break;
                    case 3:
                        if (tablero[fantasmas[i][0]][(fantasmas[i][1]) - 1] === 0) {
                            fora = 0;
                        } else {
                            fantasmas[i][2] = direccio;
                            fora = 1;
                        }
                        break;
                    case 4:
                        if (tablero[fantasmas[i][0]][(fantasmas[i][1]) + 1] === 0) {
                            fora = 0;
                        } else {
                            fantasmas[i][2] = direccio;
                            fora = 1;
                        }
                        break;
                }
            } while (fora === 0);
        }

        // Hace que busque una direccion de UN fantasma para los 3 fantasmas
        function fDireccion() {
            for (var i = 0; i < fantasmas.length; i++) {
                fRedireccion(i);
            }
        }
        //Busca direccion valida para el jugador
        function jDireccion() {
            do {
                var fora = 0;
                var direccio = aleatorio(1, 4);
                switch (direccio) {
                    case 1:
                        if (tablero[(jugador[0]) - 1][jugador[1]] === 0) {
                            fora = 0;
                        } else {
                            jugador[2] = direccio;
                            fora = 1;
                        }
                        break;
                    case 2:
                        if (tablero[(jugador[0]) + 1][jugador[1]] === 0) {
                            fora = 0;
                        } else {
                            jugador[2] = direccio;
                            fora = 1;
                        }
                        break;
                    case 3:
                        if (tablero[jugador[0]][(jugador[1]) - 1] === 0) {
                            fora = 0;
                        } else {
                            jugador[2] = direccio;
                            fora = 1;
                        }
                        break;
                    case 4:
                        if (tablero[jugador[0]][(jugador[1]) + 1] === 0) {
                            fora = 0;
                        } else {
                            jugador[2] = direccio;
                            fora = 1;
                        }
                        break;

                }
            } while (fora === 0);
        }
        //comprueba el movimiento de los fantasmas, si tiene 3 o 4 posibles caminos, llama a la funcion
        // que busca un num aleatori.
        function fComprobarMov() {
            for (var i = 0; i < fantasmas.length; i++) {

                var camino = 0;

                if (tablero[(fantasmas[i][0]) - 1][fantasmas[i][1]] === 1) {
                    camino++;
                }
                if (tablero[(fantasmas[i][0]) + 1][fantasmas[i][1]] === 1) {
                    camino++;
                }
                if (tablero[fantasmas[i][0]][(fantasmas[i][1]) - 1] === 1) {
                    camino++;
                }
                if (tablero[fantasmas[i][0]][(fantasmas[i][1]) + 1] === 1) {
                    camino++;
                }
                if (camino >= 3) {
                    fRedireccion(i);
                }
                comprovar(i);
            }
        }
        //comprueba que donde vaya a ir no sea una pared
        function comprovar(i) {

            var direccio = fantasmas[i][2];
            switch (direccio) {
                case 1:
                    if (tablero[(fantasmas[i][0]) - 1][fantasmas[i][1]] === 0) {
                        fRedireccion(i);
                    }
                    break;
                case 2:
                    if (tablero[(fantasmas[i][0]) + 1][fantasmas[i][1]] === 0) {
                        fRedireccion(i);
                    }
                    break;
                case 3:
                    if (tablero[fantasmas[i][0]][(fantasmas[i][1]) - 1] === 0) {
                        fRedireccion(i);
                    }
                    break;
                case 4:
                    if (tablero[fantasmas[i][0]][(fantasmas[i][1]) + 1] === 0) {
                        fRedireccion(i);
                    }
                    break;
            }

        }
        //mueve los fantasmas en direccion valida
        function fMover() {
            for (var i = 0; i < fantasmas.length; i++) {

                var dir = fantasmas[i][2];
                switch (dir) {
                    case 1:
                        tablero[(fantasmas[i][0]) - 1][fantasmas[i][1]] = 'F';
                        tablero[(fantasmas[i][0])][fantasmas[i][1]] = 1;
                        fantasmas[i][0] = (fantasmas[i][0]) - 1;
                        break;
                    case 2:
                        tablero[(fantasmas[i][0]) + 1][fantasmas[i][1]] = 'F';
                        tablero[(fantasmas[i][0])][fantasmas[i][1]] = 1;
                        fantasmas[i][0] = (fantasmas[i][0]) + 1;
                        break;
                    case 3:
                        tablero[fantasmas[i][0]][(fantasmas[i][1]) - 1] = 'F';
                        tablero[(fantasmas[i][0])][fantasmas[i][1]] = 1;
                        fantasmas[i][1] = (fantasmas[i][1]) - 1;
                        break;
                    case 4:
                        tablero[fantasmas[i][0]][(fantasmas[i][1]) + 1] = 'F';
                        tablero[(fantasmas[i][0])][fantasmas[i][1]] = 1;
                        fantasmas[i][1] = (fantasmas[i][1]) + 1;
                        break;
                }
            }
            fComprobarMov();
        }
        //mueve el jugador solo al inicio de la partida en direccion valida
        function jMover() {
            var dir2 = jugador[2];
            switch (dir2) {
                case 1:
                    if (tablero[jugador[0] - 1][jugador[1]] === 1) {
                        tablero[(jugador[0]) - 1][jugador[1]] = '@';
                        tablero[(jugador[0])][jugador[1]] = 1;
                        jugador[0] = (jugador[0]) - 1;
                    }
                    break;
                case 2:
                    if (tablero[jugador[0] + 1][jugador[1]] === 1) {
                        tablero[(jugador[0]) + 1][jugador[1]] = '@';
                        tablero[(jugador[0])][jugador[1]] = 1;
                        jugador[0] = (jugador[0]) + 1;
                    }
                    break;
                case 3:
                    if (tablero[jugador[0]][jugador[1] - 1] === 1) {
                        tablero[jugador[0]][(jugador[1]) - 1] = '@';
                        tablero[(jugador[0])][jugador[1]] = 1;
                        jugador[1] = (jugador[1]) - 1;
                    }
                    break;
                case 4:
                    if (tablero[jugador[0]][jugador[1] + 1] === 1) {
                        tablero[jugador[0]][(jugador[1]) + 1] = '@';
                        tablero[(jugador[0])][jugador[1]] = 1;
                        jugador[1] = (jugador[1]) + 1;
                    }
                    break;
            }

        }
        //si el fantasma està a la mateixa posicio que el jugador FIN
        function xocar() {
            for (var i = 0; i < fantasmas.length; i++) {
                if (fantasmas[i][0] === jugador[0] && fantasmas[i][1] === jugador[1]) {
                    clearInterval(a);
                    clearInterval(cronometro);
                    document.getElementById("pervic").innerHTML = 
                            "<span style='border-style: dashed; width: 300px; padding: 0.5rem;'>Game Over!!</span>";
                }
            }
        }
        
        //funcion que recoje las teclas pulsadas y les pone el valor a la posicion adecuada del jugador
        function notificaObservador(e) {
            if (e.code == "ArrowRight") {
                jugador[3] = 4;
            } else if (e.code == "ArrowLeft") {
                jugador[3] = 3;
            } else if (e.code == "ArrowUp") {
                jugador[3] = 1;
            } else if (e.code == "ArrowDown") {
                jugador[3] = 2;
            }
        }
        var element = document.getElementById("all");
        element.addEventListener("keydown", notificaObservador);
        
        
        //funcion que hace mover al jugador con las teclas pulsadas
        function jMoverTeclado() {
            var teclado = jugador[3];
            switch (teclado) {
                case 1:
                    if (tablero[jugador[0] - 1][jugador[1]] === 1) {
                        jugador[2] = jugador[3];
                    }
                    break;
                case 2:
                    if (tablero[jugador[0] + 1][jugador[1]] === 1) {
                        jugador[2] = jugador[3];
                    }
                    break;
                case 3:
                    if (tablero[jugador[0]][jugador[1] - 1] === 1) {
                        jugador[2] = jugador[3];
                    }
                    break;
                case 4:
                    if (tablero[jugador[0]][jugador[1] + 1] === 1) {
                        jugador[2] = jugador[3];
                    }
                    break;
            }
            jMover();
        }


        // adalt = 1
        // abaix = 2
        // esquerra = 3
        // dreta = 4
        //llamadas a las fuciones iniciales
        fAleatori();
        jAleatori();
        fDireccion();
        jDireccion();
        imprimir();
        consola();
        
        //funcion interval para generar un cronometro a modo de puntuacion, i llega a 300(5 min) termina y ganas
        contador_s = 0;
        cronometro = setInterval(function () {
            contador_s++;
            document.getElementById("puntuacio").innerHTML = "Puntuació: " + contador_s;
            if (contador_s == 300) {
                clearInterval(cronometro);
            }

        }
        , 1000);
        //funcion que permite que las funciones introducidas se ejecuten dependiendo del tiempo marcado.
        var a = setInterval(function () {
            if (contador_s == 300) {
                clearInterval(a);
                document.getElementById("pervic").innerHTML = 
                        "<span style='border-style: dashed; width: 300px; padding: 0.5rem;'>Victory!!</span>";
            }
            fMover();
            xocar();
            jMoverTeclado();
            imprimir();
        }
        , 100);
    </script>
</html>
